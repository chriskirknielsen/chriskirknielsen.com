"use strict";!function(){var e=new(window.AudioContext||window.webkitAudioContext),t=[{note:"C",octave:1,keyQwerty:"A",keyAzerty:"Q"},{note:"C#",octave:1,keyQwerty:"W",keyAzerty:"Z"},{note:"D",octave:1,keyQwerty:"S",keyAzerty:"S"},{note:"D#",octave:1,keyQwerty:"E",keyAzerty:"E"},{note:"E",octave:1,keyQwerty:"D",keyAzerty:"D"},{note:"F",octave:1,keyQwerty:"F",keyAzerty:"F"},{note:"F#",octave:1,keyQwerty:"T",keyAzerty:"T"},{note:"G",octave:1,keyQwerty:"G",keyAzerty:"G"},{note:"G#",octave:1,keyQwerty:"Y",keyAzerty:"Y"},{note:"A",octave:2,keyQwerty:"H",keyAzerty:"H"},{note:"A#",octave:2,keyQwerty:"U",keyAzerty:"U"},{note:"B",octave:2,keyQwerty:"J",keyAzerty:"J"},{note:"C",octave:2,keyQwerty:"K",keyAzerty:"K"}],a=new Map,n=new Map,r=new Set,o="",c=!1,i=!1;function u(e){return t.find((function(t){return(c?t.keyAzerty:t.keyQwerty)===e}))||!1}function s(e){return"".concat(e.note).concat(e.octave)}function y(e,t){return document.querySelector('.about-synth-key[data-note="'.concat(e,'"][data-octave="').concat(t,'"]'))||!1}function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.octave+(!t&&i?1:0);return{element:y(e.note,a),note:e.note,octave:a}}function d(e){return"shift"===e.key.toLowerCase()}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&"boolean"==typeof e)c=e;else{var t=document.getElementById("about-synth-keyboard-layout-switch");if(t)return c=t.checked,t.setAttribute("aria-checked",c.toString()),c}}function m(){var e=i?1:0;Array.from(document.querySelectorAll("[data-note]")).forEach((function(a){var n=a.querySelector(".about-synth-key-label"),r=function(e,a){return t.find((function(t){return t.note===e&&t.octave===parseInt(a,10)}))||!1}(a.getAttribute("data-note"),parseInt(a.getAttribute("data-octave"),10)-e);if(r){var o=c?r.keyAzerty:r.keyQwerty;n.innerText=o}else n.innerText=""}))}function f(t){var n=function(){var e=document.getElementById("synth-waveform");switch(e?parseInt(e.value,10):0){default:case 1:return"sine";case 2:return"triangle";case 3:return"square";case 4:return"sawtooth"}}()||"sine",c={attack:Math.min(10,Math.max(1e-5,parseFloat(document.getElementById("synth-osc-attack").value||0)))/10,decay:Math.min(10,Math.max(1e-5,parseFloat(document.getElementById("synth-osc-decay").value||0)))/2,sustain:10*Math.min(10,Math.max(1e-5,parseFloat(document.getElementById("synth-osc-sustain").value||0))),release:Math.min(10,Math.max(1e-5,parseFloat(document.getElementById("synth-osc-release").value||0))),filter:10*Math.min(100,Math.max(1e-5,parseFloat(document.getElementById("synth-osc-filter").value||0)))},i=e.createOscillator(),u=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,t=440,a=0;switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A"){default:case"A":a=0;break;case"A#":case"Bb":a=1;break;case"B":a=2;break;case"C":a=3;break;case"C#":case"Db":a=4;break;case"D":a=5;break;case"D#":case"Eb":a=6;break;case"E":a=7;break;case"F":a=8;break;case"F#":case"Gb":a=9;break;case"G":a=10;break;case"G#":case"Ab":a=11}return a+=12*(e-4),t*Math.pow(2,a/12)}(t.note,(t.octave||0)+1),y=1e-5,l=e.createGain(),d=e.createGain(),v=e.createGain(),m=e.createGain(),f=e.createBiquadFilter();i.type=n,i.connect(l),l.gain.value=["sine","triangle"].includes(n)?1:.25,l.connect(d),d.gain.setValueAtTime(1e-5,e.currentTime),c.attack>y?d.gain.exponentialRampToValueAtTime(.9,e.currentTime+y+c.attack):d.gain.exponentialRampToValueAtTime(.9,e.currentTime+y),d.connect(v),v.gain.setValueAtTime(1,e.currentTime+c.attack),v.gain.exponentialRampToValueAtTime(c.sustain/100,e.currentTime+c.attack+c.decay),v.connect(m),m.connect(c.filter<=1e3?f:e.destination),c.filter<=1e3&&(f.type="lowpass",f.frequency.value=c.filter+100,f.Q.value=1,f.connect(e.destination)),Number.isFinite(u)&&(i.frequency.value=u),k(o);var h=s(t);t.element.setAttribute("aria-pressed","true"),a.set(h,{osc:i,release:m,envelope:c,threshold:y}),r.add(h),i.start()}function k(t){if(t){t.element.setAttribute("aria-pressed","false");var n=s(t),o=a.get(n);if(o){var c=o.osc,i=o.release,u=o.envelope,y=o.threshold;i.gain.setValueAtTime(.9,e.currentTime),i.gain.exponentialRampToValueAtTime(1e-5,e.currentTime+Math.max(u.release,y)),c&&(setTimeout((function(){c.stop()}),1e3*Math.max(u.release,y)),a.delete(n),r.delete(n))}}}function h(e,t,a){f({element:e,note:t,octave:a})}Array.from(document.querySelectorAll(".about-synth-slider, .about-synth-waveform-button, .about-synth-key")).forEach((function(e){return e.disabled=!1})),v(),m(),document.addEventListener("click",(function(e){var t=e.target.closest(".toggleswitch");if(!t)return!0;var a=t.querySelector(".toggleswitch-checkbox"),n=e.target.closest("[data-value]");if(!n)return!0;e.preventDefault();var r="true"===n.getAttribute("data-value");return a.checked=r,!1})),document.addEventListener("change",(function(e){var t=e.target.closest(".toggleswitch-checkbox");t&&(c=t.checked,t.setAttribute("aria-checked",c.toString()),v(c),m())})),document.addEventListener("keydown",(function(e){(d(e)||e.shiftKey)&&(i=!0,m())})),document.addEventListener("keyup",(function(e){(d(e)||!e.shiftKey&&!d(e))&&(i=!1,m())})),document.addEventListener("mousedown",(function(e){var t=e.target.closest("[data-note]");if(t)return e.preventDefault(),h(t,t.getAttribute("data-note"),parseInt(t.getAttribute("data-octave"),10)),o={element:t,note:t.getAttribute("data-note"),octave:parseInt(t.getAttribute("data-octave"),10)},!1}),!1),document.addEventListener("mouseup",(function(){return k(o)}),!1),document.addEventListener("keydown",(function(e){var t=e.key.toUpperCase();if(!(e.altKey||e.metaKey||e.ctrlKey||e.repeat))if("ENTER"!==t&&" "!==t){var a=u(t);if(a){var r=l(a);n.set(t,i),f(r)}}else{var o=e.target.closest("[data-note]");o&&h(o,o.getAttribute("data-note"),parseInt(o.getAttribute("data-octave"),10))}})),document.addEventListener("keyup",(function(e){var t=e.key.toUpperCase();if(!(e.altKey||e.metaKey||e.ctrlKey)){var a;if("ENTER"===t||" "===t){var r=e.target.closest("[data-note]");r&&(a={element:r,note:r.getAttribute("data-note"),octave:parseInt(r.getAttribute("data-octave"),10)})}else{var o=u(t);if(!o)return;a=l(o);var c=n.get(t);c&&!1===e.shiftKey?(a.octave+=1,a=l(a,!0)):c||!0!==e.shiftKey||(a.octave-=1,a=l(a,!0))}k(a)}}),!1)}();